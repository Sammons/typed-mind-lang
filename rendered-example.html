<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypedMind Architecture Viewer</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            overflow: hidden;
        }
        
        #container {
            display: flex;
            height: 100vh;
        }
        
        #sidebar {
            width: 300px;
            background: #161b22;
            border-right: 1px solid #30363d;
            overflow-y: auto;
            padding: 16px;
        }
        
        #canvas {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .entity-list {
            margin-top: 16px;
        }
        
        .entity-group {
            margin-bottom: 24px;
        }
        
        .entity-group h3 {
            color: #58a6ff;
            font-size: 14px;
            text-transform: uppercase;
            margin: 0 0 8px 0;
        }
        
        .entity-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .entity-item:hover {
            background: #21262d;
            border-color: #58a6ff;
        }
        
        .entity-item.selected {
            background: #1f6feb;
            border-color: #58a6ff;
        }
        
        .entity-name {
            font-weight: 600;
            color: #f0f6fc;
        }
        
        .entity-path {
            font-size: 12px;
            color: #8b949e;
            margin-top: 4px;
        }
        
        #graph {
            width: 100%;
            height: 100%;
        }
        
        .node {
            cursor: pointer;
        }
        
        .node rect {
            fill: #21262d;
            stroke: #30363d;
            stroke-width: 2;
            transition: all 0.2s;
        }
        
        .node:hover rect {
            fill: #30363d;
            stroke: #58a6ff;
        }
        
        .node.selected rect {
            fill: #1f6feb;
            stroke: #58a6ff;
            stroke-width: 3;
        }
        
        .node text {
            fill: #f0f6fc;
            font-size: 14px;
            font-weight: 600;
            pointer-events: none;
        }
        
        .link {
            fill: none;
            stroke: #484f58;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }
        
        .link.import {
            stroke: #3fb950;
        }
        
        .link.export {
            stroke: #58a6ff;
        }
        
        .link.call {
            stroke: #f85149;
            stroke-dasharray: 5,5;
        }
        
        #details {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 300px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 16px;
            display: none;
        }
        
        #details h3 {
            margin: 0 0 12px 0;
            color: #58a6ff;
        }
        
        #details .detail-row {
            margin: 8px 0;
            font-size: 14px;
        }
        
        #details .detail-label {
            color: #8b949e;
            display: inline-block;
            width: 80px;
        }
        
        #details .detail-value {
            color: #f0f6fc;
        }
        
        .controls {
            position: absolute;
            bottom: 16px;
            left: 16px;
            display: flex;
            gap: 8px;
        }
        
        button {
            background: #21262d;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #30363d;
            border-color: #58a6ff;
        }

        #error-panel {
            position: absolute;
            bottom: 16px;
            right: 16px;
            width: 400px;
            max-height: 300px;
            background: #161b22;
            border: 1px solid #f85149;
            border-radius: 8px;
            padding: 16px;
            overflow-y: auto;
            display: none;
        }

        #error-panel h3 {
            margin: 0 0 12px 0;
            color: #f85149;
        }

        .error-item {
            margin: 8px 0;
            font-size: 13px;
            font-family: monospace;
            white-space: pre-wrap;
            color: #f85149;
        }

        .error-item .suggestion {
            color: #58a6ff;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="sidebar">
            <h2 style="margin: 0 0 16px 0; color: #f0f6fc;">TypedMind Explorer</h2>
            <input type="text" id="search" placeholder="Search entities..." style="
                width: 100%;
                padding: 8px 12px;
                background: #0d1117;
                border: 1px solid #30363d;
                border-radius: 6px;
                color: #c9d1d9;
                font-size: 14px;
            ">
            <div class="entity-list" id="entityList"></div>
        </div>
        
        <div id="canvas">
            <svg id="graph"></svg>
            <div id="details"></div>
            <div id="error-panel"></div>
            <div class="controls">
                <button onclick="window.typedMindRenderer.zoomFit()">Fit View</button>
                <button onclick="window.typedMindRenderer.toggleLayout()">Toggle Layout</button>
                <button onclick="window.typedMindRenderer.clearSelection()">Clear Selection</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script>

// Generated TypedMind Renderer
(function() {
  const graphData = {"entities":[{"name":"TodoApp","type":"Program","entry":"AppEntry","version":"2.0","position":{"line":3,"column":1},"raw":"TodoApp -> AppEntry v2.0"},{"name":"AppEntry","type":"File","path":"src/index.ts","imports":["ExpressSetup","Routes","Database","Config"],"exports":["startServer"],"position":{"line":5,"column":1},"raw":"AppEntry @ src/index.ts:"},{"name":"ExpressSetup","type":"File","path":"src/server.ts","imports":["middleware"],"exports":["app"],"position":{"line":9,"column":1},"raw":"ExpressSetup @ src/server.ts:"},{"name":"Routes","type":"File","path":"src/routes/index.ts","imports":["TodoRoutes","UserRoutes"],"exports":["router"],"position":{"line":13,"column":1},"raw":"Routes @ src/routes/index.ts:"},{"name":"TodoRoutes","type":"File","path":"src/routes/todos.ts","imports":["TodoController"],"exports":["todoRouter"],"position":{"line":17,"column":1},"raw":"TodoRoutes @ src/routes/todos.ts:"},{"name":"UserRoutes","type":"File","path":"src/routes/users.ts","imports":["UserController"],"exports":["userRouter"],"position":{"line":21,"column":1},"raw":"UserRoutes @ src/routes/users.ts:"},{"name":"TodoController","type":"File","path":"src/controllers/todo.ts","imports":["BaseController"],"exports":[],"position":{"line":25,"column":1},"raw":"TodoController @ src/controllers/todo.ts:"},{"name":"UserController","type":"File","path":"src/controllers/user.ts","imports":["BaseController"],"exports":[],"position":{"line":29,"column":1},"raw":"UserController @ src/controllers/user.ts:"},{"name":"create","type":"Function","signature":"(req, res) => Promise<void>","calls":["validateTodo","TodoModel.create"],"position":{"line":33,"column":1},"raw":"create :: (req, res) => Promise<void>","description":"Creates new todo item"},{"name":"read","type":"Function","signature":"(req, res) => Promise<void>","calls":["TodoModel.find"],"position":{"line":37,"column":1},"raw":"read :: (req, res) => Promise<void>","description":"Retrieves todo items"},{"name":"update","type":"Function","signature":"(req, res) => Promise<void>","calls":["validateTodo","TodoModel.update"],"position":{"line":41,"column":1},"raw":"update :: (req, res) => Promise<void>","description":"Updates existing todo"},{"name":"delete","type":"Function","signature":"(req, res) => Promise<void>","calls":["TodoModel.delete"],"position":{"line":45,"column":1},"raw":"delete :: (req, res) => Promise<void>","description":"Deletes a todo item"},{"name":"Database","type":"File","path":"src/db/index.ts","imports":[],"exports":["connection","models","TodoModel","UserModel"],"position":{"line":49,"column":1},"raw":"Database @ src/db/index.ts:"},{"name":"TodoModel","type":"File","path":"src/models/todo.ts","imports":["Database"],"exports":["create","find","update","delete"],"position":{"line":52,"column":1},"raw":"TodoModel @ src/models/todo.ts:"},{"name":"UserModel","type":"File","path":"src/models/user.ts","imports":["Database"],"exports":["create","find","update","delete"],"position":{"line":56,"column":1},"raw":"UserModel @ src/models/user.ts:"},{"name":"createUser","type":"Function","signature":"(req, res) => Promise<void>","calls":["UserModel.create"],"position":{"line":60,"column":1},"raw":"createUser :: (req, res) => Promise<void>","description":"Creates new user"},{"name":"readUser","type":"Function","signature":"(req, res) => Promise<void>","calls":["UserModel.find"],"position":{"line":64,"column":1},"raw":"readUser :: (req, res) => Promise<void>","description":"Gets user data"},{"name":"updateUser","type":"Function","signature":"(req, res) => Promise<void>","calls":["UserModel.update"],"position":{"line":68,"column":1},"raw":"updateUser :: (req, res) => Promise<void>","description":"Updates user"},{"name":"deleteUser","type":"Function","signature":"(req, res) => Promise<void>","calls":["UserModel.delete"],"position":{"line":72,"column":1},"raw":"deleteUser :: (req, res) => Promise<void>","description":"Deletes user"},{"name":"Config","type":"Constants","path":"src/config.ts","schema":"EnvSchema","position":{"line":76,"column":1},"raw":"Config ! src/config.ts : EnvSchema"},{"name":"BaseController","type":"File","path":"src/controllers/base.ts","imports":[],"exports":["handleError","sendResponse"],"position":{"line":78,"column":1},"raw":"BaseController @ src/controllers/base.ts:"},{"name":"middleware","type":"File","path":"src/middleware/index.ts","imports":[],"exports":["setupMiddleware"],"position":{"line":81,"column":1},"raw":"middleware @ src/middleware/index.ts:"},{"name":"app","type":"File","path":"src/app.ts","imports":["ExpressSetup"],"exports":["listen"],"position":{"line":84,"column":1},"raw":"app @ src/app.ts:"},{"name":"validateTodo","type":"File","path":"src/validators/todo.ts","imports":[],"exports":["validateCreate","validateUpdate"],"position":{"line":88,"column":1},"raw":"validateTodo @ src/validators/todo.ts:"},{"name":"startServer","type":"Function","signature":"() => Promise<void>","calls":["app.listen","Database.connect"],"position":{"line":91,"column":1},"raw":"startServer :: () => Promise<void>","description":"Starts the Express server"}],"links":[{"source":"TodoApp","target":"AppEntry","type":"export"},{"source":"AppEntry","target":"ExpressSetup","type":"import"},{"source":"AppEntry","target":"Routes","type":"import"},{"source":"AppEntry","target":"Database","type":"import"},{"source":"AppEntry","target":"Config","type":"import"},{"source":"ExpressSetup","target":"middleware","type":"import"},{"source":"Routes","target":"TodoRoutes","type":"import"},{"source":"Routes","target":"UserRoutes","type":"import"},{"source":"TodoRoutes","target":"TodoController","type":"import"},{"source":"UserRoutes","target":"UserController","type":"import"},{"source":"TodoController","target":"BaseController","type":"import"},{"source":"UserController","target":"BaseController","type":"import"},{"source":"create","target":"validateTodo","type":"call"},{"source":"update","target":"validateTodo","type":"call"},{"source":"TodoModel","target":"Database","type":"import"},{"source":"UserModel","target":"Database","type":"import"},{"source":"app","target":"ExpressSetup","type":"import"}],"errors":[{"position":{"line":37,"column":1},"message":"Orphaned entity 'read'","severity":"error","suggestion":"Remove or reference this entity"},{"position":{"line":60,"column":1},"message":"Orphaned entity 'createUser'","severity":"error","suggestion":"Remove or reference this entity"},{"position":{"line":64,"column":1},"message":"Orphaned entity 'readUser'","severity":"error","suggestion":"Remove or reference this entity"},{"position":{"line":68,"column":1},"message":"Orphaned entity 'updateUser'","severity":"error","suggestion":"Remove or reference this entity"},{"position":{"line":72,"column":1},"message":"Orphaned entity 'deleteUser'","severity":"error","suggestion":"Remove or reference this entity"}]};

  class TypedMindInteractiveRenderer {
    constructor(data) {
      this.data = data;
      this.selectedNode = null;
      this.layoutType = 'force';
      this.init();
    }

    init() {
      this.renderSidebar();
      this.renderGraph();
      this.setupSearch();
      this.renderErrors();
    }

    renderSidebar() {
      const groups = {};
      this.data.entities.forEach(entity => {
        if (!groups[entity.type]) groups[entity.type] = [];
        groups[entity.type].push(entity);
      });

      const listEl = document.getElementById('entityList');
      listEl.innerHTML = '';

      Object.entries(groups).forEach(([type, entities]) => {
        const groupEl = document.createElement('div');
        groupEl.className = 'entity-group';
        
        const titleEl = document.createElement('h3');
        titleEl.textContent = type + 's';
        groupEl.appendChild(titleEl);

        entities.forEach(entity => {
          const itemEl = document.createElement('div');
          itemEl.className = 'entity-item';
          itemEl.dataset.name = entity.name;
          
          const nameEl = document.createElement('div');
          nameEl.className = 'entity-name';
          nameEl.textContent = entity.name;
          itemEl.appendChild(nameEl);

          if (entity.path) {
            const pathEl = document.createElement('div');
            pathEl.className = 'entity-path';
            pathEl.textContent = entity.path;
            itemEl.appendChild(pathEl);
          }

          itemEl.onclick = () => this.selectNode(entity.name);
          groupEl.appendChild(itemEl);
        });

        listEl.appendChild(groupEl);
      });
    }

    renderGraph() {
      const width = window.innerWidth - 300;
      const height = window.innerHeight;

      const svg = d3.select('#graph')
        .attr('width', width)
        .attr('height', height);

      svg.selectAll('*').remove();

      // Create arrow marker
      svg.append('defs').append('marker')
        .attr('id', 'arrowhead')
        .attr('viewBox', '0 -5 10 10')
        .attr('refX', 30)
        .attr('refY', 0)
        .attr('markerWidth', 6)
        .attr('markerHeight', 6)
        .attr('orient', 'auto')
        .append('path')
        .attr('d', 'M0,-5L10,0L0,5')
        .attr('fill', '#484f58');

      // Create nodes and links
      const nodes = this.data.entities.map(e => ({
        id: e.name,
        ...e
      }));

      const links = this.data.links;

      // Create force simulation
      const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(150))
        .force('charge', d3.forceManyBody().strength(-1000))
        .force('center', d3.forceCenter(width / 2, height / 2));

      const g = svg.append('g');

      const link = g.append('g')
        .selectAll('line')
        .data(links)
        .enter().append('line')
        .attr('class', d => `link ${d.type}`);

      const node = g.append('g')
        .selectAll('.node')
        .data(nodes)
        .enter().append('g')
        .attr('class', 'node')
        .call(d3.drag()
          .on('start', dragstarted)
          .on('drag', dragged)
          .on('end', dragended));

      node.append('rect')
        .attr('width', 120)
        .attr('height', 40)
        .attr('x', -60)
        .attr('y', -20)
        .attr('rx', 6);

      node.append('text')
        .text(d => d.id)
        .attr('text-anchor', 'middle')
        .attr('dy', '.35em');

      node.on('click', (event, d) => {
        this.selectNode(d.id);
      });

      simulation.on('tick', () => {
        link
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);

        node.attr('transform', d => `translate(${d.x},${d.y})`);
      });

      // Zoom behavior
      const zoom = d3.zoom()
        .scaleExtent([0.1, 4])
        .on('zoom', (event) => {
          g.attr('transform', event.transform);
        });

      svg.call(zoom);

      this.svg = svg;
      this.g = g;
      this.zoom = zoom;
      this.simulation = simulation;

      function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }

      function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
      }

      function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
      }
    }

    selectNode(name) {
      this.selectedNode = name;
      
      // Update sidebar
      document.querySelectorAll('.entity-item').forEach(el => {
        el.classList.toggle('selected', el.dataset.name === name);
      });

      // Update graph
      d3.selectAll('.node').classed('selected', d => d.id === name);

      // Show details
      const entity = this.data.entities.find(e => e.name === name);
      if (entity) {
        this.showDetails(entity);
      }
    }

    showDetails(entity) {
      const detailsEl = document.getElementById('details');
      detailsEl.style.display = 'block';
      
      let html = `<h3>${entity.name}</h3>`;
      html += `<div class="detail-row"><span class="detail-label">Type:</span><span class="detail-value">${entity.type}</span></div>`;
      
      if (entity.path) {
        html += `<div class="detail-row"><span class="detail-label">Path:</span><span class="detail-value">${entity.path}</span></div>`;
      }
      
      if (entity.imports && entity.imports.length > 0) {
        html += `<div class="detail-row"><span class="detail-label">Imports:</span><span class="detail-value">${entity.imports.join(', ')}</span></div>`;
      }
      
      if (entity.exports && entity.exports.length > 0) {
        html += `<div class="detail-row"><span class="detail-label">Exports:</span><span class="detail-value">${entity.exports.join(', ')}</span></div>`;
      }

      if (entity.signature) {
        html += `<div class="detail-row"><span class="detail-label">Signature:</span><span class="detail-value">${entity.signature}</span></div>`;
      }

      if (entity.description) {
        html += `<div class="detail-row"><span class="detail-label">Description:</span><span class="detail-value">${entity.description}</span></div>`;
      }

      if (entity.calls && entity.calls.length > 0) {
        html += `<div class="detail-row"><span class="detail-label">Calls:</span><span class="detail-value">${entity.calls.join(', ')}</span></div>`;
      }

      if (entity.methods && entity.methods.length > 0) {
        html += `<div class="detail-row"><span class="detail-label">Methods:</span><span class="detail-value">${entity.methods.join(', ')}</span></div>`;
      }
      
      detailsEl.innerHTML = html;
    }

    setupSearch() {
      const searchEl = document.getElementById('search');
      searchEl.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        document.querySelectorAll('.entity-item').forEach(el => {
          const matches = el.textContent.toLowerCase().includes(query);
          el.style.display = matches ? 'block' : 'none';
        });
      });
    }

    renderErrors() {
      if (!this.data.errors || this.data.errors.length === 0) return;

      const errorPanel = document.getElementById('error-panel');
      errorPanel.style.display = 'block';
      
      let html = '<h3>Validation Errors</h3>';
      this.data.errors.forEach(error => {
        html += '<div class="error-item">';
        html += `${error.severity.toUpperCase()} at line ${error.position.line}, col ${error.position.column}: ${error.message}`;
        if (error.suggestion) {
          html += `<div class="suggestion">Suggestion: ${error.suggestion}</div>`;
        }
        html += '</div>';
      });
      
      errorPanel.innerHTML = html;
    }

    zoomFit() {
      const bounds = this.g.node().getBBox();
      const fullWidth = this.svg.node().clientWidth;
      const fullHeight = this.svg.node().clientHeight;
      const width = bounds.width;
      const height = bounds.height;
      const midX = bounds.x + width / 2;
      const midY = bounds.y + height / 2;
      const scale = 0.8 / Math.max(width / fullWidth, height / fullHeight);
      const translate = [fullWidth / 2 - scale * midX, fullHeight / 2 - scale * midY];

      this.svg.transition().duration(750).call(
        this.zoom.transform,
        d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale)
      );
    }

    toggleLayout() {
      alert('Layout toggle between force-directed and hierarchical views coming soon!');
    }

    clearSelection() {
      this.selectedNode = null;
      document.querySelectorAll('.entity-item').forEach(el => {
        el.classList.remove('selected');
      });
      d3.selectAll('.node').classed('selected', false);
      document.getElementById('details').style.display = 'none';
    }
  }

  // Initialize renderer
  window.typedMindRenderer = new TypedMindInteractiveRenderer(graphData);
})();

</script>
</body>
</html>